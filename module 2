#include "game.h"
#include "utils.h"
#include "scores.h"
#include <iostream>
#include <algorithm>
#include <string>

using namespace std;

void playGame(map<string, int>& scores) {
    string playerName;
    string doAgain = "yes";
    int winCount = 0;

    cout << "Enter your name: ";
    cin >> playerName;
    transform(playerName.begin(), playerName.end(), playerName.begin(), ::tolower);

    while (doAgain != "no") {
        string userChoice;
        cout << "\n" << playerName << ", enter your choice (rock, paper, or scissors): ";
        cin >> userChoice;
        transform(userChoice.begin(), userChoice.end(), userChoice.begin(), ::tolower);

        if (userChoice != "rock" && userChoice != "paper" && userChoice != "scissors") {
            cout << "Invalid input. Try again." << endl;
            continue;
        }

        string computerChoice = getComputerChoice();
        cout << "Computer chose: " << computerChoice << endl;

        string result = determineWinner(userChoice, computerChoice);
        cout << result << endl;

        if (result == "You win!") {
            winCount++;
        }

        cout << "Do you want to play again? (yes/no): ";
        cin >> doAgain;
        transform(doAgain.begin(), doAgain.end(), doAgain.begin(), ::tolower);
    }

    cout << "\nThanks for playing, " << playerName << "! You won " << winCount << " time(s)." << endl;

    if (scores[playerName] < winCount) {
        scores[playerName] = winCount;
        cout << "New high score saved!\n";
    } else {
        cout << "You didn't beat your best score of " << scores[playerName] << ".\n";
    }

    saveScores(scores);
}

